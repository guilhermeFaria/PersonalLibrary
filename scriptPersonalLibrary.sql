create schema PERSONAL_LIBRARYDB;

USE PERSONAL_LIBRARYDB;

CREATE TABLE USR_USER (
  USR_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  USR_NAME VARCHAR(50) NOT NULL,
  USR_PASSWORD VARCHAR(50) NOT NULL,
  USR_EMAIL VARCHAR(50) NOT NULL,
  CONSTRAINT USR_USER_PK PRIMARY KEY (USR_ID),
  CONSTRAINT USR_NAME_UK UNIQUE KEY (USR_NAME)
);

CREATE TABLE AUT_AUTORIZATION (
  AUT_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  AUT_NAME VARCHAR(20) NOT NULL,
  PRIMARY KEY (AUT_ID),
  UNIQUE KEY UNI_AUT_NAME (AUT_NAME)
);

CREATE TABLE UAU_USER_AUTORIZATION (
  USR_ID BIGINT UNSIGNED NOT NULL,
  AUT_ID BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY (USR_ID, AUT_ID),
  FOREIGN KEY AUT_USER_FK (USR_ID) REFERENCES USR_USER (USR_ID) ON DELETE RESTRICT ON UPDATE CASCADE,
  FOREIGN KEY AUT_AUTORIZATION_FK (AUT_ID) REFERENCES AUT_AUTORIZATION (AUT_ID) ON DELETE RESTRICT ON UPDATE CASCADE
);


INSERT INTO AUT_AUTORIZATION(AUT_NAME) VALUES('ROLE_BASIC_USER');
INSERT INTO AUT_AUTORIZATION(AUT_NAME) VALUES('ROLE_ADMIN');

insert into usr_user values (1, 'Guilherme de Almeida Faria', MD5('admin'), 'guilherme.gdaf@gmail.com');
insert into usr_user values (2, 'Rafael Sinosaki', MD5('123456'), 'rafael.sinosaki@gmail.com');
insert into usr_user values (3, 'José Levino Junior', MD5('123456'), 'levino.jr@gmail.com');
insert into usr_user values (4, 'User Teste', MD5('teste'), 'teste.user@gmail.com');

INSERT INTO UAU_USER_AUTORIZATION values (1, 1);
INSERT INTO UAU_USER_AUTORIZATION values (1, 2);
INSERT INTO UAU_USER_AUTORIZATION values (2, 2);
INSERT INTO UAU_USER_AUTORIZATION values (3, 2);
INSERT INTO UAU_USER_AUTORIZATION values (4, 2);


CREATE TABLE BK_BOOK(
  BK_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  BK_NAME VARCHAR(50) NOT NULL,
  BK_ISBN VARCHAR(20),
  BK_WRITER VARCHAR(50),
  CONSTRAINT BK_BOOK_PK PRIMARY KEY (BK_ID),
  CONSTRAINT BK_NAME_UK UNIQUE KEY (BK_NAME)
);

insert into BK_BOOK values (1, 'Harry Potter e a Pedra Filosofal', '9788700631625', 'J. K. Rownling');
insert into BK_BOOK values (2, 'Harry Potter e a Câmara Secreta', '9780747560722', 'J. K. Rownling');
insert into BK_BOOK values (3, 'Harry Potter e o Prisioneiro de Azkaban', '9789994030149', 'J. K. Rownling');
insert into BK_BOOK values (4, 'Harry Potter e o Calice de Fogo', '9789955081760', 'J. K. Rownling');
insert into BK_BOOK values (5, 'Harry Potter e a Ordem da Fenix', '9781781101148', 'J. K. Rownling');
insert into BK_BOOK values (6, 'Harry Potter e o Enigma do Principe', '9788867156009', 'J. K. Rownling');
insert into BK_BOOK values (7, 'Harry Potter e as Reliquias da Morte', '9780545010221', 'J. K. Rownling');
insert into BK_BOOK values (8, 'Percy Jackson e o Ladrão de Raios', '9788580570151', 'Rick Riordan');

CREATE TABLE GR_GENRE(
  GR_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  GR_NAME VARCHAR(80) NOT NULL,
  CONSTRAINT GR_GENRE_PK PRIMARY KEY (GR_ID),
  CONSTRAINT GR_NAME_UK UNIQUE KEY (GR_NAME)
);


insert into GR_GENRE values (1, 'Literatura Infanto-juvenil');
insert into GR_GENRE values (2, 'HQs');


CREATE TABLE BRW_BORROW(
  BRW_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
  BRW_START_DATE TIMESTAMP NOT NULL,
  BRW_END_DATE TIMESTAMP NOT NULL,
  BRW_STATUS VARCHAR(80) NOT NULL,
  USR_ID BIGINT UNSIGNED NOT NULL,
  BK_ID BIGINT UNSIGNED NOT NULL,
  PRIMARY KEY (BRW_ID),
  FOREIGN KEY BRW_USR_ID_FK (USR_ID) REFERENCES USR_USER (USR_ID),
  FOREIGN KEY BRW_BK_ID_FK (BK_ID) REFERENCES BK_BOOK (BK_ID)
);


INSERT INTO BRW_BORROW VALUES(1, '2017-10-29 10:00:03', '2017-10-30 12:00:00', 'Emprestado', 1, 1);
INSERT INTO BRW_BORROW VALUES(2, '2017-10-29 10:00:03', '2017-10-30 12:00:00', 'Emprestado', 1, 2);
INSERT INTO BRW_BORROW VALUES(3, '2017-10-30 10:20:03', '2017-11-10 12:00:00', 'Devolvido', 1, 1);
INSERT INTO BRW_BORROW VALUES(4, '2017-10-30 10:20:03', '2017-11-10 12:00:00', 'Devolvido', 1, 2);
INSERT INTO BRW_BORROW VALUES(5, '2017-10-30 10:20:03', '2017-11-10 12:00:00', 'Emprestado', 1, 3);


CREATE TABLE BKGR_BOOK_GENRE (
BKGR_ID BIGINT UNSIGNED NOT NULL AUTO_INCREMENT,
BK_ID BIGINT UNSIGNED NOT NULL,
GR_ID BIGINT UNSIGNED NOT NULL,
PRIMARY KEY (BKGR_ID),
FOREIGN KEY BKGR_BK_ID_FK (BK_ID) REFERENCES BK_BOOK (BK_ID),
FOREIGN KEY BKGR_GR_ID_FK (GR_ID) REFERENCES GR_GENRE (GR_ID)
);


insert into BKGR_BOOK_GENRE values (1, 1, 1);
insert into BKGR_BOOK_GENRE values (2, 2, 1);
insert into BKGR_BOOK_GENRE values (3, 3, 1);
insert into BKGR_BOOK_GENRE values (4, 4, 1);
insert into BKGR_BOOK_GENRE values (5, 5, 1);
insert into BKGR_BOOK_GENRE values (6, 6, 1);
insert into BKGR_BOOK_GENRE values (7, 7, 1);